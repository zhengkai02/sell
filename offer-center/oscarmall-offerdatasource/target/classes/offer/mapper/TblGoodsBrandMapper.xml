<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.iwhalecloud.retail.offer.mapper.TblGoodsBrandMapper">

    <select id="qryAllGoodsBrandList" resultType="com.iwhalecloud.retail.offer.dto.resp.TblGoodsBrandQryResp">
        select *
        from tbl_goods_brand
        where 1 = 1
        and state <![CDATA[ <> ]]> 'X'
    </select>

    <update id="deleteGoodsBrand">
        update tbl_goods_brand
        set state = 'X', modify_by = #{modifyBy}, modify_time = now()
        where 1 = 1
          and brand_id in
        <foreach collection="brandIds" item="brandId" index="index" open="(" close=")" separator=",">
            #{brandId}
        </foreach>
    </update>

    <select id="qryGoodsBrandList" resultType="com.iwhalecloud.retail.offer.dto.resp.TblGoodsBrandQryResp">
        select t.*
          from tbl_goods_brand t
          where 1 = 1
          and t.state <![CDATA[ <> ]]> 'X'
          <if test="req.isHot != null and req.isHot != ''">
              and t.is_hot = #{req.isHot}
          </if>
          <if test="req.storeId != null and req.storeId != ''">
              and t.store_id = #{req.storeId}
          </if>
          <if test="req.brandName != null and req.brandName != ''">
              and lower(t.brand_name) like lower(concat(concat('%', #{req.brandName }), '%'))
          </if>
    </select>

    <select id="qryGoodsBrandByTenantId" resultType="com.iwhalecloud.retail.offer.dto.resp.TblGoodsBrandTenantResp">
        select brand_id, brand_name, brand_img, brand_intro, state, tenant_id
        from tbl_goods_brand
        where 1 = 1
        and state <![CDATA[ <> ]]> 'X'
        order by brand_name
    </select>
    
    <select id="goodsBrandStateNum" resultType="Integer">
        select count(1)
          from tbl_goods_brand
          where 1 = 1
            and state = 'A'
            and brand_id in
        <foreach collection="brandIds" item="brandId" index="index" open="(" close=")" separator=",">
            #{brandId}
        </foreach>
    </select>

    <select id="qryGoodsBrandInCatg" resultType="com.iwhalecloud.retail.offer.dto.resp.TblGoodsBrandQryResp">
        select t.*
          from tbl_goods_cat_brand c
          left join tbl_goods_brand t on c.brand_id = t.brand_id
         where cat_id = #{catgId}
           and c.state = 'A'
           and t.state = 'A'
    </select>

</mapper>